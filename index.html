<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wedding Invitation Generator</title>

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --beige: #fdf5ec;
        --brown-dark: #3a3a3a;
        --border-color: #c2a87d;
        --shadow-light: rgba(178, 139, 110, 0.3);
        --button-hover-color: #c2a87d; /* default, will be updated dynamically */
      }

      body {
        margin: 0;
        background: var(--beige);
        font-family: Georgia, serif;
        color: var(--brown-dark);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
        flex-direction: column;
      }

      .form-section {
        background: var(--beige);
        border: 1.5px solid var(--border-color);
        border-radius: 15px;
        box-shadow: 0 4px 12px var(--shadow-light);
        max-width: 360px;
        padding: 30px 30px 40px;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .form-section h2 {
        font-family: "Dancing Script", cursive;
        font-size: 2.2rem;
        margin: 0 0 20px 0;
        color: var(--brown-dark);
        text-align: center;
      }

      label {
        font-weight: 600;
        font-size: 1rem;
        color: var(--brown-dark);
      }

      input[type="text"],
      input[type="file"] {
        background: #fff7ee;
        border: 1.5px solid var(--border-color);
        border-radius: 12px;
        padding: 12px 15px;
        font-size: 1rem;
        font-family: Georgia, serif;
      }

      input[type="text"]::placeholder {
        color: #b28b6e;
        font-style: italic;
      }

      button {
        margin-top: 25px;
        background-color: var(--brown-dark);
        color: var(--beige);
        font-family: Georgia, serif;
        font-weight: 700;
        font-size: 1.1rem;
        padding: 12px 0;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 0 4px 10px var(--shadow-light);
        transition: background-color 0.3s ease;
      }

      button:hover {
        background-color: var(--button-hover-color);
      }

      /* Invitation card */
      .invite-preview {
        width: 360px;
        height: 650px;
        background-size: cover;
        background-position: center;
        border-radius: 18px;
        box-shadow: 0 8px 20px var(--shadow-light);
        padding: 40px 25px;
        color: var(--brown-dark);
        font-family: Georgia, serif;

        /* Center content vertically and horizontally */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;

        /* subtle white text shadow for readability */
        text-shadow: 0 0 3px rgba(255, 255, 255, 0.8);
      }

      /* Wrapper for all text content to center easily */
      .invite-text {
        width: 100%;
      }

      .invite-preview .small {
        font-variant: small-caps;
        letter-spacing: 3px;
        font-size: 1rem;
        margin-bottom: 40px; /* increased space below */
        font-weight: normal; /* not bold */
      }

      .invite-preview h1 {
        font-family: "Dancing Script", cursive;
        font-weight: 700;
        font-size: 5.5rem;
        margin: 0 0 25px 0;
        line-height: 1;
      }

      .invite-preview .names {
        font-family: "Playfair Display", serif;
        font-size: 1.8rem;
        font-weight: 700;
        letter-spacing: 0.6px;
        line-height: 1.7;
        margin-bottom: 28px;
        font-style: normal;
      }

      /* "and" styled like "We do" but smaller */
      .invite-preview .names .and {
        display: block;
        font-family: "Dancing Script", cursive;
        font-weight: 700;
        font-style: normal; /* not italic */
        font-size: 2.2rem; /* smaller size */
        margin: 7px 0;
        letter-spacing: normal;
        line-height: 1;
      }

      .invite-preview .message {
        font-style: italic;
        font-size: 1.15rem;
        margin-bottom: 28px;
      }

      .invite-preview .details {
        font-size: 1.05rem;
        font-style: italic;
        line-height: 1.5;
        margin: 5px 0;
        font-weight: normal; /* not bold */
      }

      /* Center and style back button */
      .back-btn {
        margin: 25px auto 0 auto;
        display: block;
        background: none;
        border: none;
        font-family: Georgia, serif;
        font-weight: 700;
        font-size: 1.1rem;
        color: var(--brown-dark);
        cursor: pointer;
        text-decoration: underline;
        padding: 8px 15px;
        border-radius: 8px;
        transition: background-color 0.25s ease;
      }

      .back-btn:hover {
        background-color: var(--button-hover-color);
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="form-section" id="formSection">
      <h2>Create Your Wedding Invitation</h2>

      <label for="brideName">Bride's Name</label>
      <input type="text" id="brideName" placeholder="Korina Thompson" />

      <label for="groomName">Groom's Name</label>
      <input type="text" id="groomName" placeholder="Alfredo torres" />

      <label for="weddingDate">Date (with year)</label>
      <input
        type="text"
        id="weddingDate"
        placeholder="SATURDAY, 24TH AUGUST 2025"
      />

      <label for="weddingTime">Time</label>
      <input type="text" id="weddingTime" placeholder="2 o'clock" />

      <label for="weddingAddress">Address</label>
      <input
        type="text"
        id="weddingAddress"
        placeholder="123 Anywhere St, Any city, ST 12345"
      />

      <label for="bgUpload">Upload Background Image</label>
      <input type="file" id="bgUpload" accept="image/*" />

      <button id="generateBtn">Generate Invitation</button>
    </div>

    <div class="hidden" id="inviteSection">
      <div class="invite-preview" id="invite">
        <div class="invite-text">
          <p class="small">TOGETHER WITH THEIR FAMILIES</p>
          <h1>We do</h1>
          <p class="names" id="names">
            RASHA EL ALAMI
            <span class="and">and</span>
            ISMAIL HOURFANE
          </p>
          <p class="message">Invite you to<br />celebrate their marriage</p>
          <p class="details" id="date">24TH AUGUST 2025</p>
          <p class="details" id="time">at 2 pm</p>
          <p class="details" id="address">123 anywhere, lovely city</p>
        </div>
      </div>
      <button class="back-btn" id="backBtn">‚Üê Edit Invitation</button>
    </div>

    <script>
      // Function to get average color of an image from a canvas context
      function getAverageColor(ctx, width, height) {
        const imageData = ctx.getImageData(0, 0, width, height);
        const data = imageData.data;
        let r = 0,
          g = 0,
          b = 0;
        const count = width * height;

        for (let i = 0; i < data.length; i += 4) {
          r += data[i];
          g += data[i + 1];
          b += data[i + 2];
        }

        return {
          r: Math.round(r / count),
          g: Math.round(g / count),
          b: Math.round(b / count),
        };
      }

      // Function to lighten or darken a color by a percentage
      function adjustColor({ r, g, b }, percent) {
        return {
          r: Math.min(255, Math.max(0, Math.round(r + (255 - r) * percent))),
          g: Math.min(255, Math.max(0, Math.round(g + (255 - g) * percent))),
          b: Math.min(255, Math.max(0, Math.round(b + (255 - b) * percent))),
        };
      }

      // Convert RGB object to CSS rgb string
      function rgbToCss({ r, g, b }) {
        return `rgb(${r}, ${g}, ${b})`;
      }

      const brideInput = document.getElementById("brideName");
      const groomInput = document.getElementById("groomName");
      const dateInput = document.getElementById("weddingDate");
      const timeInput = document.getElementById("weddingTime");
      const addressInput = document.getElementById("weddingAddress");
      const bgUpload = document.getElementById("bgUpload");

      const inviteNames = document.getElementById("names");
      const inviteDate = document.getElementById("date");
      const inviteTime = document.getElementById("time");
      const inviteAddress = document.getElementById("address");
      const invite = document.getElementById("invite");

      const formSection = document.getElementById("formSection");
      const inviteSection = document.getElementById("inviteSection");
      const generateBtn = document.getElementById("generateBtn");
      const backBtn = document.getElementById("backBtn");

      generateBtn.addEventListener("click", () => {
        inviteNames.innerHTML = `${brideInput.value.trim().toUpperCase()}
          <span class="and">and</span>
          ${groomInput.value.trim().toUpperCase()}`;
        inviteDate.textContent = dateInput.value.trim().toUpperCase();
        inviteTime.textContent = `at ${timeInput.value.trim()}`;
        inviteAddress.textContent = addressInput.value.trim();

        const file = bgUpload.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
              const targetRatio = 360 / 650;

              let sx, sy, sWidth, sHeight;
              const imgRatio = img.width / img.height;

              if (imgRatio > targetRatio) {
                sHeight = img.height;
                sWidth = sHeight * targetRatio;
                sx = (img.width - sWidth) / 2;
                sy = 0;
              } else {
                sWidth = img.width;
                sHeight = sWidth / targetRatio;
                sx = 0;
                sy = (img.height - sHeight) / 2;
              }

              const canvas = document.createElement("canvas");
              canvas.width = 360;
              canvas.height = 650;
              const ctx = canvas.getContext("2d");

              ctx.drawImage(
                img,
                sx,
                sy,
                sWidth,
                sHeight,
                0,
                0,
                canvas.width,
                canvas.height
              );

              // Set the invitation background
              invite.style.backgroundImage = `url('${canvas.toDataURL()}')`;
              invite.style.backgroundColor = "transparent";

              // Calculate average color of the image to adjust button hover color
              const avgColor = getAverageColor(
                ctx,
                canvas.width,
                canvas.height
              );

              // Lighten average color by ~40% for hover effect
              const hoverColor = adjustColor(avgColor, 0.4);

              // Update CSS variable for button hover background
              document.documentElement.style.setProperty(
                "--button-hover-color",
                rgbToCss(hoverColor)
              );
            };
            img.src = e.target.result;
          };
          reader.readAsDataURL(file);
        } else {
          invite.style.backgroundImage = "none";
          invite.style.backgroundColor = "var(--beige)";
          document.documentElement.style.setProperty(
            "--button-hover-color",
            "var(--border-color)"
          );
        }

        formSection.classList.add("hidden");
        inviteSection.classList.remove("hidden");
      });

      backBtn.addEventListener("click", () => {
        inviteSection.classList.add("hidden");
        formSection.classList.remove("hidden");
      });
    </script>
  </body>
</html>
